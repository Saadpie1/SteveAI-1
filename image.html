<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>SteveAI â€“ Image Generator | Built by Ahmed & Saadpie</title>
  <link rel="icon" href="/assets/favicon.png" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  
  <style>
    /* ... [Keeping your existing CSS base] ... */
    
    /* ADDED: Resolution & Edit Styles */
    .resolution-badge {
        background: #222;
        border: 1px solid #333;
        color: #00ffcc;
        font-size: 0.7rem;
        padding: 2px 6px;
        border-radius: 4px;
        margin-left: 5px;
    }
    
    .upload-zone {
        width: 100%;
        padding: 1rem;
        border: 2px dashed #333;
        border-radius: 8px;
        cursor: pointer;
        margin-bottom: 1rem;
        transition: border-color 0.3s;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 10px;
        color: #777;
    }
    
    .upload-zone:hover, .upload-zone.active {
        border-color: #ff00ff;
        color: #fff;
    }

    #imagePreview {
        max-height: 80px;
        border-radius: 4px;
        display: none;
    }

    /* Existing Style Overrides for 2025 Look */
    body { background: #0c0c0c; color: #e0e0e0; margin: 0; font-family: sans-serif; }
    header { background: #1a1a1a; padding: 0.8rem 1.5rem; border-bottom: 2px solid #00ffcc; display: flex; justify-content: space-between; align-items: center; }
    .logo-link { text-decoration: none; color: #00ffcc; display: flex; align-items: center; }
    .logo { height: 28px; margin-right: 8px; }
    nav a { color: #e0e0e0; text-decoration: none; padding: 0.5rem; font-size: 0.85rem; }
    nav a.active { color: #00ffcc; border-bottom: 2px solid #00ffcc; }
    main { max-width: 1200px; margin: 2rem auto; padding: 0 1rem; text-align: center; }
    .controls { background: #151515; padding: 2rem; border-radius: 12px; border: 1px solid #333; display: flex; flex-direction: column; gap: 1rem; }
    input, select, button { padding: 1rem; border-radius: 8px; border: 1px solid #333; background: #222; color: #fff; font-size: 1rem; }
    button { background: #00ffcc; color: #000; font-weight: 800; cursor: pointer; border: none; }
    button:hover { background: #ff00ff; color: #fff; }
    #result { margin-top: 2rem; display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1.5rem; }
    .img-container { background: #1a1a1a; padding: 1rem; border-radius: 12px; border: 1px solid #333; }
    .img-container img { width: 100%; border-radius: 8px; margin-bottom: 1rem; }
    .collab-tag { color: #ff00ff; font-weight: bold; font-size: 0.8rem; letter-spacing: 1px; }
  </style>
</head>
<body>
  <header>
    <a href="/" class="logo-link">
        <img src="SteveAI-logo.jpg" alt="Logo" class="logo" /> 
        <h1>SteveAI <span style="font-size: 0.6em; color: #ff00ff;">IMAGE STUDIO</span></h1>
    </a>
    <nav>
      <a href="/">Home</a>
      <a href="/chat.html">Chat</a>
      <a href="/image.html" class="active">Image</a>
      <a href="/vid-gen">Video</a> 
      <a href="/3d">3D</a>
      <a href="/about.html">About</a>
    </nav>
  </header>

  <main>
    <h1>ðŸŽ¨ Ultra-HD Visual Arts</h1>
    <span class="collab-tag">Orchestrated by Ahmed & Saadpie</span>
    
    <div class="controls">
        <div class="upload-zone" id="dropZone">
            <i class="fa-solid fa-cloud-arrow-up"></i>
            <span id="uploadText">Drop image to Edit or click to upload</span>
            <img id="imagePreview" alt="Preview" />
            <input type="file" id="imageInput" hidden accept="image/*" />
        </div>

        <input type="text" id="prompt" placeholder="Describe your masterpiece or image edit..." />
        
        <div style="display: flex; gap: 10px; width: 100%; justify-content: center; flex-wrap: wrap;">
            <select id="modelSelect"></select>
            <select id="sizeSelect">
                <option value="square">1:1 Square</option>
                <option value="landscape">16:9 Landscape</option>
                <option value="portrait">9:16 Portrait</option>
                <option value="ultrawide">21:9 Cinematic</option>
            </select>
            <select id="numImagesSelect">
                <option value="1">1 Image</option>
                <option value="4">Batch Mode (4)</option>
            </select>
        </div>
        
        <button id="generateBtn">GENERATE MASTERPIECE</button>
    </div>
    
    <div id="result"></div>
  </main>

  <script type="module">
    import { generateImage, SUPPORTED_SIZES } from './image.js'; 
    import { PUTER_IMAGE_MODELS } from './puter-image.js';

    const generateBtn = document.getElementById("generateBtn");
    const promptInput = document.getElementById("prompt");
    const resultDiv = document.getElementById("result");
    const modelSelect = document.getElementById("modelSelect");
    const sizeSelect = document.getElementById("sizeSelect");
    const imageInput = document.getElementById("imageInput");
    const dropZone = document.getElementById("dropZone");
    const imagePreview = document.getElementById("imagePreview");

    let base64Image = null;

    // Populate Models from both Ahmed Engine and Puter Families
    function populateModels() {
        const puterGroup = document.createElement('optgroup');
        puterGroup.label = "â”€â”€ PUTER UNLIMITED (Banana) â”€â”€";
        PUTER_IMAGE_MODELS.forEach(m => {
            const opt = document.createElement('option');
            opt.value = m.id;
            opt.textContent = m.label;
            puterGroup.appendChild(opt);
        });
        modelSelect.appendChild(puterGroup);
        // Add Legacy Ahmed Models (Static fallback)
        const ahmedGroup = document.createElement('optgroup');
        ahmedGroup.label = "â”€â”€ AHMED ENGINE (High Fidelity) â”€â”€";
        ahmedGroup.innerHTML = `<option value="provider-4/imagen-4">Imagen 4 Pro</option><option value="provider-5/flux-dev">Flux.1 Dev</option>`;
        modelSelect.appendChild(ahmedGroup);
    }

    // Handle Upload for Image-to-Image
    dropZone.onclick = () => imageInput.click();
    imageInput.onchange = e => {
        const file = e.target.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = (ex) => {
                base64Image = ex.target.result;
                imagePreview.src = base64Image;
                imagePreview.style.display = 'block';
                document.getElementById('uploadText').style.display = 'none';
                dropZone.classList.add('active');
            };
            reader.readAsDataURL(file);
        }
    };

    populateModels();

    generateBtn.onclick = async () => {
      const prompt = promptInput.value.trim();
      if (!prompt) return alert("Please enter a prompt!");

      generateBtn.disabled = true;
      generateBtn.innerHTML = '<i class="fa-solid fa-spinner fa-spin"></i> ORCHESTRATING...';

      try {
        // We call our hybrid generator that handles txt2img and img2img
        const urls = await generateImage(
            prompt, 
            modelSelect.value, 
            base64Image, 
            sizeSelect.value, 
            parseInt(document.getElementById('numImagesSelect').value)
        ); 

        resultDiv.innerHTML = urls.map((url, i) => `
            <div class="img-container">
                <img src="${url}" loading="lazy">
                <a href="${url}" target="_blank" style="color:#00ffcc; text-decoration:none; font-weight:bold;">DOWNLOAD HD</a>
            </div>
        `).join('');

      } catch (err) {
        resultDiv.innerHTML = `<p style="color:#ff00ff;">Engine Error: ${err.message}</p>`;
      } finally {
        generateBtn.disabled = false;
        generateBtn.textContent = "GENERATE MASTERPIECE";
      }
    };
  </script>
</body>
</html>
